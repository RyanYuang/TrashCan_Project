# 01 - 项目概览与功能

目标：做一款可自动开盖、可语音/串口控制的双桶智能垃圾桶，能够显示温湿度、检测烟雾和桶满状态，并用蜂鸣器/LED 报警。

## 系统组成（硬件）
- 主控：STM32F103RCT6，72 MHz，丰富的定时器/ADC/I2C/UART 资源，价格低且生态成熟。  
- 感知：
  - 超声波测距 x2：检测有人靠近触发开盖。
  - MQ-2 烟雾传感器 x2（模拟量）：可燃气体/烟雾报警。
  - TCRT5000 红外对射（或反射）x2（模拟量）：检测垃圾是否堆满。
  - AHT30 温湿度 x2（I2C）：监测桶内环境。
  - 语音/串口模块（UART）：外部语音识别或上位机发送开合命令。
- 显示与执行：
  - OLED 0.96" x2（软 I2C）：分别显示“其他垃圾”“厨余垃圾”信息。
  - 舵机 x2（PWM）：驱动左右两个桶盖。
  - 蜂鸣器 x2（GPIO）：声光提醒。
  - RGB LED（GPIO）：当前仅用到红灯指示报警。

## 软件模块
- 设备驱动：`Device/` 下为各器件的最小驱动，尽量保持单一职责。
- 应用层：`App/User_Main.c` 负责初始化、周期任务和回调处理。
- HAL/外设初始化：`Core/`, `Drivers/` 由 CubeMX 生成，不建议手改。

## 主要特性
- 低功耗但反应快：超声波用定时器输入捕获测距；舵机用 PWM；ADC+DMA 同时采集多路模拟量。
- 双通道设计：两组桶互不影响，参数和显示分别独立。
- 报警策略：温度 > 28 °C 或烟雾超阈值（ADC ≥ 1000）即红灯+蜂鸣器；桶满时禁止对应舵机再开启。
- 交互多样：接近感应、语音/串口指令、双 OLED 实时数据显示。

## 工作流程（概要）
1. 上电：初始化舵机、OLED1/2、AHT30(两路)、超声波、ADC 校准。
2. 主循环：
   - 启动 ADC DMA 读取 MQ-2 与 TCRT5000。
   - 启动 UART DMA 等待外部指令。
   - 触发两路超声波测距。
   - 读取两路温湿度并刷新 OLED。
   - 根据温度/烟雾/满桶标志控制蜂鸣器和 LED。
3. 中断/回调：
   - `HAL_TIM_IC_CaptureCallback`：根据回波计算距离，< 4 cm 自动开盖，否则视语音模式与满桶标志决定是否关闭。
   - `HAL_ADC_ConvCpltCallback`：解析 4 路 ADC；更新桶满标志；更新 OLED；烟雾超阈值触发报警。
   - `HAL_UART_RxCpltCallback`：解析 1 字节指令（1/2 控制桶1开关，3/4 控制桶2）。

## 参考文件
- 引脚分配表：`Doc/Trash_Can_Pin_define.md`
- 代码入口：`App/User_Main.c`
- 关键驱动：`Device/aht30.c`, `Device/ultrasonic.c`, `Device/servo.c`, `Device/OLED.c`, `Device/OLED2.c`, `Device/beep.c`, `Device/rgb.c`
